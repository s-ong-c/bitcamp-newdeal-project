<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>메인 화면</title>

<link rel="stylesheet" type="text/css" href="../../fonts/font-awesome-4.7.0/css/font-awesome.min.css">
<!-- <link rel="stylesheet" type="text/css" href="fonts/iconic/css/material-design-iconic-font.min.css"> -->
<link rel="stylesheet" href="../node_modules/bootstrap/dist/css/bootstrap.min.css">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" type="text/css" href="main.css">
<link rel="stylesheet" type="text/css" href="header.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"></script>
<style>
.preview-images-zone > .image-zone {
    width: 100%;
    height: 100%;
    text-align: center;
}
.preview-images-zone {
    width: 100%;
    border: 1px solid #ddd;
    min-height: 220px;
    /* display: flex; */
    padding: 5px 5px 0px 5px;
    position: relative;
    overflow:auto;
    white-space: nowrap;
}
.preview-images-zone > .preview-image {
    border: 1px solid;
    height: 200px;
    width: 200px;
    position: relative;
    margin-right: 5px;
    /* float: left; */
    margin-bottom: 5px;
    display: inline-block;
    vertical-align: top;
}

.preview-images-zone > .preview-image > .image-zone {
    width: 100%;
    height: 100%;
    text-align: center;
}
.preview-images-zone > .preview-image > .image-zone > img {
    width: 100%;
    height: 100%;
    cursor: pointer;
}
.preview-images-zone > .preview-image > .image-zone > video {
    width: 100%;
    height: 100%;
    cursor: pointer;
}

.preview-images-zone > .preview-image > .image-cancel {
    font-size: 18px;
    position: absolute;
    top: 0;
    right: 0;
    font-weight: bold;
    margin-right: 10px;
    cursor: pointer;
    display: none;
    z-index: 100;
}
.preview-image:hover > .image-zone {
    cursor: move;
    opacity: .5;
}
.preview-image:hover > .image-cancel {
    display: block;
}
.ui-sortable-helper {
    width: 90px !important;
    height: 90px !important;
}

.container {
    padding-top: 50px;
}

.image-preview-input {
    position: relative;
    overflow: hidden;
    margin: 0px;    
    color: #333;
    background-color: #fff;
    border-color: #ccc;    
}
.hide-bullets {
    list-style:none;
    margin-left: -40px;
    margin-top:20px;
}

.thumbnail {
    padding: 0;
}

.carousel-inner>.item>img, .carousel-inner>.item>a>img, .carousel-inner>.item>video, .carousel-inner>.item>a>video {
    width: 100%;
}

.thumbnail>img, .thumbnail a>img, .thumbnail>video, .thumbnail a>video {
    margin-right: auto;
    margin-left: auto;
        width: 100%;
}

.img-responsive, .thumbnail>img, .thumbnail a>img, .carousel-inner>.item>img, .carousel-inner>.item>a>img, .thumbnail>video, .thumbnail a>video, .carousel-inner>.item>video, .carousel-inner>.item>a>video {
    display: block;
    width: 100% \9;
    max-width: 100%;
    height: auto;
}
figcaption {
    position: absolute;
    bottom: 1em;
    right: 0;
    padding: .25em 1em .25em .25em;
    background: #000;
    color: #fff;
    font-weight: 200;
}
.hide-bullets > li > a, a:visited {
cursor: pointer;
color:#003569;
text-decoration:none;
}

.preview-image.selected {
    box-shadow: 0 0 0 4px #00c09e;
}
</style>
<link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
</head>
<body>      
	<div class="jangter">
         <header>
       <div id="h-div" >
            
            <div style="flex-grow: 2;"></div><!-- 로고 왼쪽 공간 -->
            <div style="flex-grow: 3;"><!-- 로고 오른쪽 공간 -->
                <img id="logo" style="cursor: pointer;" onclick="location.href='http://localhost:8080/second-hand-trade/html/main/main.html'" src="../../images/icons/cart.png">
            </div>
            
            <div id="sbi" style="flex-grow: 3;">
                <input id="search" type="text">&nbsp;&nbsp;
                <button id="sBtn" class="btn btn-outline-light">
                    <span>검색</span>
                </button>
            </div><!--#sbi -->
            
            <div id="hRight">
                <img id="profile" style="width: 25px; height: 25px; border-radius: 10px;" src="../emptyProfile.jpg">
                
                <span id="login-name" style="color: white;"><span style="text-decoration: underline">&nbsp;name&nbsp;</span>님</span>
                &nbsp;&nbsp;
                <button id="my-page"  onclick="location.href='http://www.naver.com' "><p id="my-page-p">&nbsp;My Page&nbsp;</p></button>&nbsp;&nbsp;
                <button id="logout"><p id="logout-p">&nbsp;Logout&nbsp;</p></button>
            </div><!-- #hRight -->
	       </div><!-- #h-div --> 
        </header>
	
	<div id="sct-s">
	   <section id="s1" class="ss"><!-- 180*404 -->
	       <article id="a11" class="aa aa1">
	           <button class="ctgrLinks" onclick="openBoard(event, 'a21')" id="ctgrDefaultOpen">
	                   <p class="ctgrLinks-p">전체보기</p>
	           </button>
	       </article>
	       <article id="a12" class="aa aa1">
               <button class="ctgrLinks" onclick="openBoard(event, 'a22')">
                        <p class="ctgrLinks-p">의류, 패션잡화</p>
               </button>
           </article>
           <article id="a13" class="aa aa1">
               <button class="ctgrLinks"  onclick="openBoard(event, 'a23')">
                        <p class="ctgrLinks-p">뷰티, 미용</p>
               </button>
           </article>
           <article id="a14" class="aa aa1">
               <button class="ctgrLinks"  onclick="openBoard(event, 'a24')">
                        <p class="ctgrLinks-p">디지털, 가전</p>
               </button>
           </article>
           <article id="a15" class="aa aa1">
               <button class="ctgrLinks"  onclick="openBoard(event, 'a25')">
                        <p class="ctgrLinks-p">생활, 식품</p>
               </button>
           </article>
           <article id="a16" class="aa aa1">
               <button class="ctgrLinks"  onclick="openBoard(event, 'a26')">
                        <p class="ctgrLinks-p">기타</p>
               </button>
           </article>
           
           <article id="a17" class="aa aa1">
               <button class="ctgrLinks btn btn-primary" type="button" data-toggle="modal"data-target="#writeModal" data-whatever="@mdo" 
                    style="background: white; border: 1px solid #cccccc;">
                        <p class="ctgrLinks-p">글쓰기</p>
               </button>
           </article>
	   </section>
	
        <section id="s2" class="ss"><!-- 500*6985 -->
        
           <article id="a21" class="aa aa2">
           
              <div class="boardSpace"></div>
              
              <div class="boardInfo">
                    <a class="boardInfo-s" data-toggle="modal" data-target="#myModal" href="#" 
                        style="color: white;  float: left; margin-left: 10px;">은우의 미소를 팝니다..</a>
                    <a class="boardInfo-s" href="#" style="color: white;  float: right; margin-right: 10px;">차은우</a>
                    <img style="float: right; margin-right: 6px;"src="../../images/icons/profile.png">
                    
              </div>
              <div class="boardPic">
                    <img style="height: 370px; width: 590px; cursor: pointer;"  data-toggle="modal" data-target="#myModal" src="../../images/cha.png">
              </div>
              <div class="boardPrice">
                    <span style="color: white;  margin-right: 20px; margin-top: 10px;">1억 원 </span>
              </div> 
              
              <div class="boardSpace"></div>
              
              <div class="boardSpace"></div>
              
              <div class="boardInfo">
                    <span class="boardInfo-s" style="color: white; border: 1px solid black;">제목</span>
                    <span class="boardInfo-s"  style="color: white; border: 1px solid black;">이름, 사진</span>
                    <img src="../../images/icons/profile.png">
              </div>
              <div class="boardPic">
                    <span style="color: white; border: 1px solid black;">판매상품사진</span>
              </div>
              <div class="boardPrice">
                    <span style="color: white; border: 1px solid black; margin-right: 20px;">ㅇㅇㅇ원 </span>
              </div> 
              
              <div class="boardSpace"></div>
              
              <div class="boardSpace"></div>
              
              <div class="boardInfo">
                    <span class="boardInfo-s" style="color: white; border: 1px solid black;">제목</span>
                    <span class="boardInfo-s"  style="color: white; border: 1px solid black;">이름, 사진</span>
                    <img src="../../images/icons/profile.png">
              </div>
              <div class="boardPic">
                    <span style="color: white; border: 1px solid black;">판매상품사진</span>
              </div>
              <div class="boardPrice">
                    <span style="color: white; border: 1px solid black; margin-right: 20px;">ㅇㅇㅇ원 </span>
              </div> 
              
              <div class="boardSpace"></div>
              

             
           </article>
           <article id="a22" class="aa aa2">
           </article>
           
           <article id="a23" class="aa aa2">
               <p>게시글3</p>
           </article>
           <article id="a24" class="aa aa2">
               <p>게시글4</p>
           </article>
           <article id="a25" class="aa aa2">
               <p>게시글5</p>
           </article>
           <article id="a26" class="aa aa2">
               <p>게시글6</p>
           </article>
        </section>
    
        <section id="s3" class="ss"><!-- 308*1156 -->
           <article id="a31" class="aa aa3">
               <p>광고1</p>
           </article>
           <article id="a32" class="aa aa3">
               <p>광고2</p>
           </article>
           <article id="a33" class="aa aa3">
               <p>광고3</p>
           </article>
        </section>
    </div><!-- #sct-s -->
    
   <!-- Modal -->
  <div class="modal fade" id="myModal" role="dialog">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header" style="border: 1px solid pink;">
           <h4 class="modal-title" style="float: left; border: 1px solid steelblue;">은우의 미소를 팝니다.. 아니 다내꺼야</h4>
           <button type="button" class="close" data-dismiss="modal" style="float: right;">&times;</button>
            </div>
         <div style="border: 1px solid tomato; margin-top: 5px; margin-left: 15px; ">
           <img style="float: left;" src="../../images/icons/profile.png">&nbsp;&nbsp;&nbsp;
           <a style="float: left;" href="http://localhost:8080/second-hand-trade/html/main/main.html">차은우</a>
           <span>작성일</span>
          </div>
        <div class="modal-body">

<!-- 본문 슬라이드 사진 -->
<div class="slideshow-container" style="margin-top: 27px;">

  <div class="mySlides fade-pic">
    <div class="numbertext">1 / 3</div>
    <img class="bd-img" src="../../images/cha.png">
  </div>

  <div class="mySlides fade-pic">
    <div class="numbertext">2 / 3</div>
    <img  class="bd-img"src="../../images/cha2.jpg" >
  </div>

  <div class="mySlides fade-pic">
    <div class="numbertext">3 / 3</div>
    <img  class="bd-img"src="../../images/cha3.jpg">
  </div>

  <a class="prev" onclick="plusSlides(-1)">&#10094;</a>
  <a class="next" onclick="plusSlides(1)">&#10095;</a>
</div><!-- .slideshow-container -->
<br>

<div style="text-align:center;">
  <span class="dot" onclick="currentSlide(1)"></span> 
  <span class="dot" onclick="currentSlide(2)"></span> 
  <span class="dot" onclick="currentSlide(3)"></span> 
  <img id="heart-pic" src="../../images/icons/heart-0.png" style="float: right; margin-right: 15px; width: 35px; height: 35px; cursor: pointer;">
</div>
          <hr>
          <p>은우의 미소는 백만불짜리 미소입니다.</p>
          <p>팔 수도 .. 살 수도 없습ㄴ디ㅏ..</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">닫기</button>
        </div>
      </div>
    </div>
  </div><!-- #myModal -->
    
    <!-- boardWrite modal -->
<div class="modal fade" id="writeModal" tabindex="-1" role="dialog" aria-labelledby="modalLabel" aria-hidden="true" style="width: 100%; border: 5px solid black;">
  <div class="modal-dialog modal-lg"  style="border: 5px solid steelblue; width: 1000px;">
    <div class="modal-content" style="border: 5px solid darkred;">
      <div class="modal-header" style="border: 5px solid darkslateblue;">
        <h6 class="modal-title" id="modalLabel" style="margin-right: 5px; width: 40px">제목</h6>
        <input type="text" style="border: 1px solid #cccccc; width: 700px;">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
      </div>
      <div class="modal-body" style="border: 5px solid darkslategrey;">
      <div class="modal-category">
            <label class="container-radio">의류, 패션잡화
                <input class="input-radio" type="radio" checked="checked" name="radio">
                <span class="checkmark"></span>
            </label>
            <label class="container-radio">뷰티, 미용
                <input class="input-radio" type="radio" name="radio">
                <span class="checkmark"></span>
            </label>
            <label class="container-radio">디지털, 가전
                <input class="input-radio" type="radio" name="radio">
                <span class="checkmark"></span>
            </label>
            <label class="container-radio">생활, 식품
                <input class="input-radio" type="radio" name="radio">
                <span class="checkmark"></span>
            </label>
            <label class="container-radio">기타
                <input class="input-radio" type="radio" name="radio">
                <span class="checkmark"></span>
            </label>
      </div>
      <div class="modal-textarea">
            <textarea rows="15" cols="102" style="border: 1px solid black;"></textarea>
      </div>
      
      <div class="container">
    <div class="preview-images-zone" style="border: 1px solid darkslateblue; height: 20px;"></div>
    <fieldset class="form-group" style="text-align: right;">
        <div class="btn btn-default image-preview-input" onclick="$('#pro-image').click()"> 
        <span class="glyphicon glyphicon-folder-open"></span> 
        <span class="image-preview-input-title">Browse</span>
        </div>
            <input type="file" id="pro-image" name="pro-image" accept="image/*,video/*"style="display: none;" class="form-control" multiple>
        <button type="button" id="upload" class="btn btn-labeled btn-default"> <span class="btn-label"><i class="glyphicon glyphicon-upload"></i> </span>Upload</button>
    </fieldset>
    <form id="uploadForm" method="post" />
</div>
      </div>
      <div class="modal-footer" style="border: 5px solid darkorange;">
        <button type="button" class="btn btn-default" data-dismiss="modal">닫기</button>
        <button type="button" class="btn btn-primary">등록하기</button>
      </div>
    </div>
  </div>
</div><!-- #writeModal -->

    </div><!-- .jangter -->
   
	<script src="../node_modules/jquery/dist/jquery.min.js"></script>
	<script src="../node_modules/popper.js/dist/umd/popper.min.js"></script>
	<script src="../node_modules/bootstrap/dist/js/bootstrap.min.js"></script>
	<script src="../js/jquery.bit.js"></script>
    <script src="main.js"></script>
    
    <script>

    </script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
</body>
<script src="upload.js"></script>
<script src="../html/js/common.js"></script>
<script>
var path = "http://faint1122.s3.ap-northeast-2.amazonaws.com/faint1122";
$(document).ready(function() {

    $("#pro-image").on("change",function(){
        readImage(this.files);
    })

    $(".preview-images-zone").sortable();
    
    $(document).on('click', '.image-cancel', function() {
        let no = $(this).data('no');
    
        $.ajax({
            //url : "/deleteFile",
            url:`${serverApiAddr}/json/upload/deleteFile`,
            type : "post",
            data : {
                fileName : $(this).attr("data-src")
            },
            dataType : "text",
            success : function(result) {
                if (result == 'deleted') {
                    $(".preview-image.preview-show-"+no).remove();
                }
            }
        }); 
    });
    //드래그 영력에서 드래그에 대한 이벤트 막음
    $(".preview-images-zone").on("dragenter dragover", function(event) {
        event.preventDefault();
        console.log("dragover");
    });

    //파일 드롭 시 업로드 처리
    $(".preview-images-zone").on("drop", function(event) {
        event.preventDefault();
        console.log("drop");
        var droplist = event.originalEvent.dataTransfer.files;
        readImage(droplist);

    });
    $("#upload").on("click", function(event){
        event.preventDefault();

        var form = $("#uploadForm");
        //파일 개수
        var cnt = 0;
        
        var str = "";
        $(".image-cancel").each(function(index){
            var data = new Object();
            var obj = $(this).siblings("div",".image-zone");
            //파일 url 추가
            data.fileUrl =$(this).attr("data-src");
            //파일 type 추가
            data.fileType = obj.attr("data-type");

            console.log(obj[0]);
            data.filter = obj.attr("class").split(" ")[1];
            console.log(JSON.stringify(data));
            str += "<input type='hidden' name='files' value='" + JSON.stringify(data) + "'> ";
            
            cnt++;
    

        });
        
        if(cnt==0){
            alert("이미지나 동영상을 추가하세요.");1
            return false;
        }
        //사진 없으면 업로드 실패
        
        form.append(str);
        form.attr("action", `${serverApiAddr}/json/post/register`);
        form.submit();
        
    
    });
    /*  
        //첨부파일 추가
        
        //
        form.attr("action", `${serverApiAddr}/html/register.html`);
        
        form.submit(); */
 
    
    //필터 적용
   $(".hide-bullets > li > a").on("click", function(){
       //선택된 이미지가 없을때
       //전체 필터 적용
       if($(".selected").length == 0){
           $(".image-zone").attr("class", "image-zone " + this.title);
       }else{
           //선택된 이미지만 필터 적용
           $(".selected > .image-zone").attr("class" , "image-zone " + this.title);
           
       }
   });
    
    $(".explore, .new-post, .follow-list, .account, .logo").on("click", function(event){
        unloadCheck();
    });
});

//파일 업로드 중 검색 할 경우
// 검색 결과 없을 때 enter키 막기
function unloadCheck(){
    var result = confirm("작성을 중지하고 나가시겠습니까?");
       console.log(result);
       if(result){
           //event.preventDefault();
           $(".image-cancel").click();
           //return true;
       }else{
           event.preventDefault();
       } 
}

var num = 0;
function readImage(files) {
    if (window.File && window.FileList && window.FileReader) {
    
        console.log(files);
        var output = $(".preview-images-zone");
        $(files).each(function() {
            console.log(this);
            console.log(this.type);
            if(this.type.indexOf('image') ==-1 && this.type.indexOf('video') ==-1) {
                console.log("이상한 파일");
                return true;
            }
            var file = this;
            var formData = new FormData();
            formData.append("file", this);
            $.ajax({
                //url : 'json/upload/uploadAjax',
                url:`${serverApiAddr}/json/upload/uploadAjax`,
                data : formData,
                dataType : 'text',
                processData : false,
                contentType : false,
                type : 'POST',
                success : function(data) {
                    var fileInfo = getFileInfo(data);
                    
                    var html =  '<div class="preview-image preview-show-' + num + '" onclick="selectUploadImaage(this)">' +
                                '<div class="image-cancel" data-no="' + num + '" data-src="'+ fileInfo.fullName+'">x</div>' +
                                '<div class="image-zone" id="image-zone-' + num + '" data-type="'+fileInfo.fileType+'">' ;
                    if(fileInfo.fileType == "image"){
                        html =  html + '<img id="pro-img-' + num + '" src="' + path + data + '"></div>' +
                           '</div>';
                    }else{
                        html =  html + '<video id="pro-img-' + num + '" src="' + path + data + '" loop="true" autoplay></div>' +
                           '</div>';
                    }
                  
                    output.append(html);
                    
                    //처음 업로드 되는 이미지로 필터 이미지 변경
                    if(num == 0){
                        if(fileInfo.fileType != 'video'){
                            $(".thumbnail > img").css("display","block");
                            $(".thumbnail > video").css("display","none");
                            $(".thumbnail > img").attr("src", path + data);
                        }
                        else{
                            $(".thumbnail > img").css("display","none");
                            $(".thumbnail > video").css("display","block");
                            $(".thumbnail > video").attr("src", path + data);
                        }
                    }
                    num = num + 1;
                    
                   
                }
            }); //ajax end
        }); 
        
        $("#pro-image").val('');
    } else {
        console.log('Browser not support');
    }
}  
 
function selectUploadImaage(obj){
    //소스 읽기
    var src = $("#"+obj.children[1].children[0].id).attr("src");
    //타입 읽기
    var type = $("#"+obj.children[1].id).attr("data-type");

    //클래스 추가
    $(obj).toggleClass("selected");
    if(type == 'image'){
        $(".thumbnail > video").css("display","none");
        $(".thumbnail > img").css("display","block");
        $(".thumbnail > img").attr("src", src);
    }else if(type == 'video'){
        $(".thumbnail > img").css("display","none");
        $(".thumbnail > video").css("display","block");
        $(".thumbnail > video").attr("src", src);
        
    }
}
</script>


 
    <script src="../vendor/animsition/js/animsition.min.js"></script>
    <script src="../vendor/bootstrap/js/popper.js"></script>
    <script src="../vendor/bootstrap/js/bootstrap.min.js"></script>
    <script src="../vendor/select2/select2.min.js"></script>
    <script src="../vendor/daterangepicker/moment.min.js"></script>
    <script src="../vendor/daterangepicker/daterangepicker.js"></script>
    <script src="../vendor/countdowntime/countdowntime.js"></script>
    <script src="../js/main.js"></script>
    <script src="../html/js/jquery.bit.js"></script>
</body>
</html>